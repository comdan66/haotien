window.fbAsyncInit=function(){FB.init({appId:"695906407210191",xfbml:!0,version:"v2.4"})},function(e,t,i){var s,n=e.getElementsByTagName(t)[0];e.getElementById(i)||(s=e.createElement(t),s.id=i,s.src="//connect.facebook.net/zh_TW/sdk.js",n.parentNode.insertBefore(s,n))}(document,"script","facebook-jssdk"),Array.prototype.last=function(){return this[this.length-1]},Array.prototype.column=function(k){return this.map(function(t){return k?eval("t."+k):t})},window.gmc=function(){$(window).trigger("gm")};var OAML=function(){};$(function(){function e(){function e(e,t){function i(){}i.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new i,e.prototype.constructor=e}function t(e,i){this.marker_=e,this.handCursorURL_=e.handCursorURL,this.labelDiv_=document.createElement("div"),this.labelDiv_.style.cssText="position: absolute; overflow: hidden;",this.eventDiv_=document.createElement("div"),this.eventDiv_.style.cssText=this.labelDiv_.style.cssText,this.eventDiv_.setAttribute("onselectstart","return false;"),this.eventDiv_.setAttribute("ondragstart","return false;"),this.crossDiv_=t.getSharedCross(i)}OAML=function(e){e=e||{},e.labelContent=e.labelContent||"",e.initCallback=e.initCallback||function(){},e.labelAnchor=e.labelAnchor||new google.maps.Point(0,0),e.labelClass=e.labelClass||"markerLabels",e.labelStyle=e.labelStyle||{},e.labelInBackground=e.labelInBackground||!1,"undefined"==typeof e.labelVisible&&(e.labelVisible=!0),"undefined"==typeof e.raiseOnDrag&&(e.raiseOnDrag=!0),"undefined"==typeof e.clickable&&(e.clickable=!0),"undefined"==typeof e.draggable&&(e.draggable=!1),"undefined"==typeof e.optimized&&(e.optimized=!1),e.crossImage=e.crossImage||"http"+("https:"===document.location.protocol?"s":"")+"://maps.gstatic.com/intl/en_us/mapfiles/drag_cross_67_16.png",e.handCursor=e.handCursor||"http"+("https:"===document.location.protocol?"s":"")+"://maps.gstatic.com/intl/en_us/mapfiles/closedhand_8_8.cur",e.optimized=!1,this.label=new t(this,e.crossImage,e.handCursor),google.maps.Marker.apply(this,arguments)},e(t,google.maps.OverlayView),t.getSharedCross=function(e){var i;return"undefined"==typeof t.getSharedCross.crossDiv&&(i=document.createElement("img"),i.style.cssText="position: absolute; z-index: 1000002; display: none;",i.style.marginLeft="-8px",i.style.marginTop="-9px",i.src=e,t.getSharedCross.crossDiv=i),t.getSharedCross.crossDiv},t.prototype.onAdd=function(){var e,i,s,n,o,a,l,r=this,g=!1,p=!1,m=20,d="url("+this.handCursorURL_+")",c=function(e){e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},h=function(){r.marker_.setAnimation(null)};this.getPanes().overlayImage.appendChild(this.labelDiv_),this.getPanes().overlayMouseTarget.appendChild(this.eventDiv_),"undefined"==typeof t.getSharedCross.processed&&(this.getPanes().overlayImage.appendChild(this.crossDiv_),t.getSharedCross.processed=!0),this.listeners_=[google.maps.event.addDomListener(this.eventDiv_,"mouseover",function(e){(r.marker_.getDraggable()||r.marker_.getClickable())&&(this.style.cursor="pointer",google.maps.event.trigger(r.marker_,"mouseover",e))}),google.maps.event.addDomListener(this.eventDiv_,"mouseout",function(e){!r.marker_.getDraggable()&&!r.marker_.getClickable()||p||(this.style.cursor=r.marker_.getCursor(),google.maps.event.trigger(r.marker_,"mouseout",e))}),google.maps.event.addDomListener(this.eventDiv_,"mousedown",function(e){p=!1,r.marker_.getDraggable()&&(g=!0,this.style.cursor=d),(r.marker_.getDraggable()||r.marker_.getClickable())&&(google.maps.event.trigger(r.marker_,"mousedown",e),c(e))}),google.maps.event.addDomListener(document,"mouseup",function(t){var i;if(g&&(g=!1,r.eventDiv_.style.cursor="pointer",google.maps.event.trigger(r.marker_,"mouseup",t)),p){if(o){i=r.getProjection().fromLatLngToDivPixel(r.marker_.getPosition()),i.y+=m,r.marker_.setPosition(r.getProjection().fromDivPixelToLatLng(i));try{r.marker_.setAnimation(google.maps.Animation.BOUNCE),setTimeout(h,1406)}catch(s){}}r.crossDiv_.style.display="none",r.marker_.setZIndex(e),n=!0,p=!1,t.latLng=r.marker_.getPosition(),google.maps.event.trigger(r.marker_,"dragend",t)}}),google.maps.event.addListener(r.marker_.getMap(),"mousemove",function(t){var n;g&&(p?(t.latLng=new google.maps.LatLng(t.latLng.lat()-i,t.latLng.lng()-s),n=r.getProjection().fromLatLngToDivPixel(t.latLng),o&&(r.crossDiv_.style.left=n.x+"px",r.crossDiv_.style.top=n.y+"px",r.crossDiv_.style.display="",n.y-=m),r.marker_.setPosition(r.getProjection().fromDivPixelToLatLng(n)),o&&(r.eventDiv_.style.top=n.y+m+"px"),google.maps.event.trigger(r.marker_,"drag",t)):(i=t.latLng.lat()-r.marker_.getPosition().lat(),s=t.latLng.lng()-r.marker_.getPosition().lng(),e=r.marker_.getZIndex(),a=r.marker_.getPosition(),l=r.marker_.getMap().getCenter(),o=r.marker_.get("raiseOnDrag"),p=!0,r.marker_.setZIndex(1e6),t.latLng=r.marker_.getPosition(),google.maps.event.trigger(r.marker_,"dragstart",t)))}),google.maps.event.addDomListener(document,"keydown",function(e){p&&27===e.keyCode&&(o=!1,r.marker_.setPosition(a),r.marker_.getMap().setCenter(l),google.maps.event.trigger(document,"mouseup",e))}),google.maps.event.addDomListener(this.eventDiv_,"click",function(e){(r.marker_.getDraggable()||r.marker_.getClickable())&&(n?n=!1:(google.maps.event.trigger(r.marker_,"click",e),c(e)))}),google.maps.event.addDomListener(this.eventDiv_,"dblclick",function(e){(r.marker_.getDraggable()||r.marker_.getClickable())&&(google.maps.event.trigger(r.marker_,"dblclick",e),c(e))}),google.maps.event.addListener(this.marker_,"dragstart",function(){p||(o=this.get("raiseOnDrag"))}),google.maps.event.addListener(this.marker_,"drag",function(){p||o&&(r.setPosition(m),r.labelDiv_.style.zIndex=1e6+(this.get("labelInBackground")?-1:1))}),google.maps.event.addListener(this.marker_,"dragend",function(){p||o&&r.setPosition(0)}),google.maps.event.addListener(this.marker_,"position_changed",function(){r.setPosition()}),google.maps.event.addListener(this.marker_,"zindex_changed",function(){r.setZIndex()}),google.maps.event.addListener(this.marker_,"visible_changed",function(){r.setVisible()}),google.maps.event.addListener(this.marker_,"labelvisible_changed",function(){r.setVisible()}),google.maps.event.addListener(this.marker_,"title_changed",function(){r.setTitle()}),google.maps.event.addListener(this.marker_,"labelcontent_changed",function(){r.setContent()}),google.maps.event.addListener(this.marker_,"labelanchor_changed",function(){r.setAnchor()}),google.maps.event.addListener(this.marker_,"labelclass_changed",function(){r.setStyles()}),google.maps.event.addListener(this.marker_,"labelstyle_changed",function(){r.setStyles()})]},t.prototype.onRemove=function(){var e;for(this.labelDiv_.parentNode.removeChild(this.labelDiv_),this.eventDiv_.parentNode.removeChild(this.eventDiv_),e=0;e<this.listeners_.length;e++)google.maps.event.removeListener(this.listeners_[e])},t.prototype.draw=function(){this.setContent(),this.setTitle(),this.setStyles()},t.prototype.setContent=function(){var e=this.marker_.get("labelContent");"undefined"==typeof e.nodeType?(this.labelDiv_.innerHTML=e,this.eventDiv_.innerHTML=this.labelDiv_.innerHTML):(this.labelDiv_.innerHTML="",this.labelDiv_.appendChild(e),e=e.cloneNode(!0),this.eventDiv_.innerHTML="",this.eventDiv_.appendChild(e))},t.prototype.setTitle=function(){this.eventDiv_.title=this.marker_.getTitle()||""},t.prototype.setStyles=function(){var e,t;this.labelDiv_.className=this.marker_.get("labelClass"),this.eventDiv_.className=this.labelDiv_.className,this.labelDiv_.style.cssText="",this.eventDiv_.style.cssText="",t=this.marker_.get("labelStyle");for(e in t)t.hasOwnProperty(e)&&(this.labelDiv_.style[e]=t[e],this.eventDiv_.style[e]=t[e]);this.setMandatoryStyles()},t.prototype.setMandatoryStyles=function(){this.labelDiv_.style.position="absolute",this.labelDiv_.style.overflow="","undefined"!=typeof this.labelDiv_.style.opacity&&""!==this.labelDiv_.style.opacity&&(this.labelDiv_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(opacity='+100*this.labelDiv_.style.opacity+')"',this.labelDiv_.style.filter="alpha(opacity="+100*this.labelDiv_.style.opacity+")"),this.eventDiv_.style.position=this.labelDiv_.style.position,this.eventDiv_.style.overflow=this.labelDiv_.style.overflow,this.eventDiv_.style.opacity=.01,this.eventDiv_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(opacity=1)"',this.eventDiv_.style.filter="alpha(opacity=1)",this.setAnchor(),this.setPosition(),this.setVisible()},t.prototype.setAnchor=function(){var e=this.marker_.get("labelAnchor");this.labelDiv_.style.marginLeft=-e.x+"px",this.labelDiv_.style.marginTop=-e.y+"px",this.eventDiv_.style.marginLeft=-e.x+"px",this.eventDiv_.style.marginTop=-e.y+"px"},t.prototype.setPosition=function(e){var t=this.getProjection().fromLatLngToDivPixel(this.marker_.getPosition());"undefined"==typeof e&&(e=0),this.labelDiv_.style.left=Math.round(t.x)+"px",this.labelDiv_.style.top=Math.round(t.y-e)+"px",this.eventDiv_.style.left=this.labelDiv_.style.left,this.eventDiv_.style.top=this.labelDiv_.style.top,this.setZIndex()},t.prototype.setZIndex=function(){var e=this.marker_.get("labelInBackground")?-1:1;"undefined"==typeof this.marker_.getZIndex()?(this.labelDiv_.style.zIndex=parseInt(this.labelDiv_.style.top,10)+e,this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex):(this.labelDiv_.style.zIndex=this.marker_.getZIndex()+e,this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex)},t.prototype.setVisible=function(){this.labelDiv_.style.display=this.marker_.get("labelVisible")?this.marker_.getVisible()?"block":"none":"none",this.eventDiv_.style.display=this.labelDiv_.style.display;var e=this.marker_.get("initCallback");e(this.labelDiv_)},e(OAML,google.maps.Marker),OAML.prototype.setMap=function(e){google.maps.Marker.prototype.setMap.apply(this,arguments),this.label.setMap(e)}}function t(e){return"M 0 0 m -"+e+", 0 a "+e+","+e+" 0 1,0 "+2*e+",0 a "+e+","+e+" 0 1,0 -"+2*e+",0"}function i(e,t){var i=Math.pow(10,t);return Math.round(e*i)/i}function s(e){google.maps.geometry.spherical&&k.html(i(google.maps.geometry.spherical.computeLength(e)/1e3,2)),k.hasClass("s")||k.addClass("s")}function n(e){return++h>v?location.reload(!0):(u||(u=!0,$.when($.ajax("https://spreadsheets.google.com/feeds/list/"+b+"/1/public/values?alt=json&t="+(new Date).getTime(),{dataType:"json"})).done(function(i){if(u=!1,i&&i.feed&&i.feed.entry&&i.feed.entry.length){r=i.feed.entry.filter(function(e){return"undefined"!=typeof e["gsx$時間戳記"].$t&&"undefined"!=typeof e.gsx$latitudelongitude.$t}).map(function(e){var t=e.gsx$latitudelongitude.$t.split(",");if(t.length<2)return null;var i=t.map(function(e){return parseFloat(e)});return{t:e["gsx$時間戳記"].$t,p:new google.maps.LatLng(i[0],i[1])}}).filter(function(e){return null!=e}),p||(p=new google.maps.Polyline({map:d,strokeColor:"rgba(249, 39, 114, .45)",strokeWeight:5})),p.setPath(r.column("p")),c||(c=new OAML({map:d,draggable:!1,optimized:!1,labelContent:'<img src="img/m2.png" />',icon:{path:"M 0 0"},labelAnchor:new google.maps.Point(20,69),labelClass:"m"})),c.setPosition(r.last().p),c.setZIndex(999),g.forEach(function(e){e.setMap(null)}),g=[];var n=parseInt(r.length/5,10);g=r.map(function(e,i){return i%n?null:new OAML({position:e.p,draggable:!1,map:d,zIndex:1,icon:{path:t(3),strokeColor:"rgba(255, 68, 170, 1)",strokeWeight:1,fillColor:"rgba(255, 68, 170, 1)",fillOpacity:.5},labelContent:e.t,labelAnchor:new google.maps.Point(-5,-5),labelClass:"t"})}).filter(function(e){return e}),(new google.maps.Geocoder).geocode({latLng:r.last().p},function(e,t){t==google.maps.GeocoderStatus.OK&&e.length&&(e=e[0])&&e.formatted_address&&(m||(m=new OAML({draggable:!1,map:d,labelContent:"",labelAnchor:new google.maps.Point(150,-8),labelClass:"a",icon:{path:"M 0 0"}})),m.labelContent=e.formatted_address,m.setPosition(r.last().p))}),e&&(d.setCenter(r.last().p),L.addClass("a"),setTimeout(function(){L.remove()},275)),y||d.setCenter(r.last().p),clearTimeout(_),_=setTimeout(s.bind(this,r.column("p")),2e3)}})),void 0)}function o(){if(!d){e();var t=new google.maps.LatLng(23.569396231491233,120.3030703338623);d=new google.maps.Map(D.get(0),{zoom:16,disableDefaultUI:!0,gestureHandling:"greedy",center:t}),d.mapTypes.set("style1",new google.maps.StyledMapType([{featureType:"administrative.land_parcel",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"poi",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.business",stylers:[{visibility:"on"}]},{featureType:"poi.park",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"on"}]}])),d.setMapTypeId("style1"),d.addListener("dragend",function(){y=!0}),$("#z>*").click(function(){d.setZoom(d.zoom+($(this).index()?-1:1))}),n(!0),setInterval(n,f)}}function a(){var e=l[Math.floor(Math.random()*l.length)],t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","https://maps.googleapis.com/maps/api/js?"+(e?"key="+e+"&":"")+"language=zh-TW&libraries=visualization&callback=gmc"),(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(t),t.onload=o}var l=[],r=[],g=[],p=null,m=null,d=null,c=null,h=0,v=30,u=!1,y=!1,_=null,f=5e3,b="1WRuhRwkEq0f0fmu_OYlJXPMfhJjPi0jPSiOL63ujsu0",D=$("#m"),k=$("#l"),L=$("#y");$(window).bind("gm",o),a()});